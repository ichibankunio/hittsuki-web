<!DOCTYPE html>
<script src="wasm_exec.js"></script>
<script>
// Polyfill
if (!WebAssembly.instantiateStreaming) {
    WebAssembly.instantiateStreaming = async (resp, importObject) => {
        const source = await (await resp).arrayBuffer();
        return await WebAssembly.instantiate(source, importObject);
    };
}

const go = new Go();
WebAssembly.instantiateStreaming(fetch("ebiten.wasm"), go.importObject).then(result => {
    go.run(result.instance);
});
</script>
<!-- <body>
    <input id="input" type="file">
</body> -->

<script>
    function saveImage(bytes) {
        console.log("js was called")
        // console.log(bytes)

        // Uint8ArrayをBlobオブジェクトに変換
        var blob = new Blob([bytes], { type: 'image/png' }); // typeを適切な画像形式に合わせて設定

        // BlobオブジェクトをURLに変換
        var imageUrl = URL.createObjectURL(blob);

        // 画像要素を作成して表示
        var imgElement = document.createElement('img');
        imgElement.src = imageUrl;
        // document.body.appendChild(imgElement);

        var a = document.createElement("a");
		// 保存する画像データをセットする。
		a.href = imageUrl;
		// (参考) href の内容は DataURL 形式のテキストです。
		console.log(a.href);
		// ファイル名をセットする。
		a.download = "hittsuki_" + getDate() + ".png";
		// a タグをクリックする。リンクをクリックする動作になります。
		a.click();

        alert('画像を保存しました！ストーリーに投稿してね！');
    }

    function getDate() {
        let now = new Date();
        let year = now.getFullYear();
        let month = now.getMonth() + 1;
        let date = now.getDate();
        let hours = now.getHours();
        let minutes = now.getMinutes();
        let seconds = now.getSeconds();
        month = month < 10 ? '0' + month : month;
        date = date < 10 ? '0' + date : date;
        hours = hours < 10 ? '0' + hours : hours;
        minutes = minutes < 10 ? '0' + minutes : minutes;
        seconds = seconds < 10 ? '0' + seconds : seconds;

        let yyyymmddhhmmss = '' + year + month + date + hours + minutes + seconds;
        return yyyymmddhhmmss;
    }
</script>